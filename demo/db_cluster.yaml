<%
  raise "You must set deploy_id (e.g. -p deploy_id=UATSVCS-PROD-2015051501-RE)" unless $deploy_id
  $region = MU.curRegion unless $region
%>

appname: db
region: <%= $region %>
databases:
- name: cluster
  dns_sync_wait: false
  alarms:
  - name: cpu-usage
    metric_name: CPUUtilization
    statistic: Average
    period: 60
    evaluation_periods: 2
    threshold: 60
    comparison_operator: GreaterThanOrEqualToThreshold
    enable_notifications: true
  - name: connections
    metric_name: DatabaseConnections
    statistic: Average
    period: 60
    unit: Count
    evaluation_periods: 2
    threshold: 20
    comparison_operator: GreaterThanOrEqualToThreshold
    enable_notifications: true
  engine_version: 5.6.10a
  create_cluster: true
  cluster_node_count: 3
  parameter_group_family: aurora5.6
  engine: aurora
  publicly_accessible: false
  size: db.r3.large
  multi_az_on_create: true
  port: 3306
  backup_retention_period: 35
  multi_az_on_deploy: false
  add_firewall_rules: 
  - rule_name: dbcluster
  vpc:
    deploy_id: <%= $deploy_id %>
    subnet_pref: all_private

firewall_rules:
- name: dbcluster
  vpc:
    deploy_id: <%= $deploy_id %>
  rules: 
  - port: 3306
    hosts:
    - 0.0.0.0/0
