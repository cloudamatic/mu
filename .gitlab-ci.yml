image: centos

stages:
  - Lint
  - Test
  - Sec_Test
  - Smoke_Test
  - Merge/Tag
  - Dockerbuild
  - Deploy
  
Rubocop:
  stage: Lint
  image: chef/chefdk:latest
  script:
    - rubocop bin/
    - rubocop modules/
  allow_failure: true

Cookstyle:
  stage: Lint
  image: chef/chefdk:latest
  script:
    - cookstyle cookbooks/
  allow_failure: true
  
Foodcritic:
  stage: Lint
  image: chef/chefdk:latest
  script:
    - foodcritic cookbooks/
  allow_failure: true

ChefSpec:
  stage: Test
  image: chef/chefdk:latest
  script:
    - for d in ./cookbooks/*/ ; do (cd "$d" && chef exec rspec); done
  allow_failure: true

Rspec:
  stage: Test
  image: chef/chefdk:latest
  script:
    - echo "rspec"
  allow_failure: true

.New_Berks:
  stage: Test
  image: chef/chefdk:latest
  script:
    - apt-get -qq update
    - apt-get -qq install git -y
    - for d in ./cookbooks/*/ ; do (cd "$d" && berks install); done
    - for d in ./cookbooks/*/ ; do (cd "$d" && berks verify); done
    - for d in ./cookbooks/*/ ; do (cd "$d" && berks outdated); done
  allow_failure: true
  
Berks:
  stage: Test
  image: chef/chefdk:latest
  script:
    - apt-get -qq update
    - apt-get -qq install git -y
    - rm -rf Berksfile.lock
    - berks install
    - berks verify
    - berks outdated
  allow_failure: true

BuildMan:
  stage: Sec_Test
  script:
    - echo "BuildMan!"
  allow_failure: true

Smoke_Test:
  stage: Smoke_Test
  script:
    - echo "Insert some of Amrit's Stuff here"
  allow_failure: true

Merge/Tag:
  stage: Merge/Tag
  script:
    - echo "Merge and tag here"
  allow_failure: true

Dockerbuild:
  stage: Dockerbuild
  script:
    - echo "Build Mu Docker Container"
  allow_failure: true

